
@{
	ViewBag.Title = "Create";
}

	<div class="card-hover-shadow-2x card-border card" style="margin-bottom:35px;">
		<div class="card-header">
			<h3 style="color:black;">Create User</h3>
		</div>
        <div class="card-body">
            @if ((ViewBag.GetRoles == "Role_UM11") && (ViewBag.GetMNRoles == "PDSCPAGE006"))
            {
                using (Html.BeginForm("Create", "UserManagement", FormMethod.Post, new { id = "Create" }))
                {
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Employee  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <select id="emp" name="emp" class="form-control">
                                    <option value="">--Selected--</option>
                                </select>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">User Type  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <select onchange="CheckUserType();" id="usertype" name="usertype" class="form-control">
                                    <option value="">--Selected--</option>
                                </select>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">User Group  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <select onchange="Get_DropDown_Position();" id="usergroup" name="usergroup" class="form-control">
                                    <option value="">--Selected--</option>
                                </select>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Position  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <select id="position" name="position" class="form-control">
                                    <option value="">--Selected--</option>
                                </select>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Username  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <input id="username" name="username" class="form-control" />
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Password  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <input type="password" id="password" name="password" class="form-control" />
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Status  : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <select id="status" name="status" class="form-control">
                                    <option value="">--Selected--</option>
                                    <option value="false">Inactive</option>
                                    <option value="true">Active</option>
                                </select>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row form-group">
                            <div class="col-sm-3 ">

                            </div>
                            <div class="col-sm-3 ">
                                <label class="text-font-13">Link Image : </label>
                            </div>
                            <div class="col-sm-3 ">
                                <textarea id="linkimage" name="linkimage" class="form-control" rows="4"></textarea>
                            </div>
                            <div class="col-sm-3 ">

                            </div>
                        </div>
                        <div class="col-md-12 text-center">
                            <button id="SaveBtn" type="submit" hidden>save</button>
                        </div>

                    </div>
                }
                <div class="col-md-12 text-center" style="margin-bottom:25px;">
                    <button onclick="Save();" class="mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn btn-outline-success">
                        <i class="fas fa-save"></i>
                        SAVE
                    </button>
                </div>
            }
            else
            {
            <div class="card-body">
                <label style="color:red; font-weight:bold; font-size: larger">Please contact staff for set roles</label>
            </div>

            }
        </div>
</div>
	<a href="@Url.Action("Index", "UserManagement")" class="float pointer" style="color:white;">
		<i class="fas fa-arrow-left B-icon"></i>
	</a>
<script src="~/ThridParty/Theam/ArchitectUI-Pro/assets/core/jquery.min.js" type="text/javascript"></script>
<script src="~/lib/select2/js/select2.min.js"></script>
<script>
	$.fn.select2.defaults.set("theme", "bootstrap");

	$('#emp').select2();
	$('#usergroup').select2();
	$('#position').select2();
	$('#usertype').select2();
	$('#status').select2();

	$(document).ready(() =>
	{
        On_Loading();
		Setting();
        
	});

	function Setting()
	{
		Get_DropDown_Emp();
		Get_DropDown_UserGroup();
		Get_DropDown_UserType();
		//Get_DropDown_Position();
		//Get_DropDown_Status();
	}

	function CheckUserType()
	{
		let UserType = $('#usertype').val();

		if (UserType == "AD") {
			$('#password').prop("disabled", true);
		}
		else if (UserType == "No AD") {
			$('#password').prop("disabled", false);
		}
		else if (UserType == "")
		{

		}

	}

	function Save()
	{
		

		//var status = CheckUser($('#username').val());
		//alert(status);

		@*if (!status)
		{*@
			swal({
				title: "",
				text: "Are you sure? Do you want to save it?",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "Yes",
				cancelButtonText: "No",
				closeOnConfirm: false,
				closeOnCancel: false
			},
				function (isConfirm) {


					if ($('#usertype').val() == "AD") //if Ad  ignor Password
					{
						if (isConfirm) {
							if (
								($('#emp').val() != "" && $('#emp').val() != null) &&
								($('#usertype').val() != "" && $('#usertype').val() != null) &&
								($('#usergroup').val() != "" && $('#usergroup').val() != null) &&
								($('#position').val() != "" && $('#position').val() != null) &&
								($('#username').val() != "" && $('#username').val() != null) &&
								($('#status').val() != "" && $('#status').val() != null)
							) {
								$('#SaveBtn').trigger('click');
							}
							else {
								swal("", "Employee , UserType,User Group,Position,Username,Status not have a value !!!", "error");
							}

						}
						else {

							swal("", "Cancelled", "error");
						}
					}
					else // No Ad Check All
					{
						if (isConfirm) {
							if (
								($('#emp').val() != "" && $('#emp').val() != null) &&
								($('#usertype').val() != "" && $('#usertype').val() != null) &&
								($('#usergroup').val() != "" && $('#usergroup').val() != null) &&
								($('#position').val() != "" && $('#position').val() != null) &&
								($('#username').val() != "" && $('#username').val() != null) &&
								($('#password').val() != "" && $('#password').val() != null) &&
								($('#status').val() != "" && $('#status').val() != null)
							) {
								$('#SaveBtn').trigger('click');
							}
							else {
								swal("", "Employee , UserType,User Group,Position,Username,Password,Status not have a value !!!", "error");
							}

						}
						else {

							swal("", "Cancelled", "error");
						}
					}
				});
		@*}
		else
		{
			swal("", "Can't username this , try to use other username", "error");
		}*@

	}

	@*function CheckUser(Username)
	{
		$.ajax({
			type: "POST",
			url: "/UserManagement/Check_Username_Duplicate",
			data: { Username : Username},
			//contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (response)
			{

				return response[0];
			},
			failure: function (response) {
			},
			error: function (response) {
			}
		});
	}*@

	function Get_DropDown_UserType()
	{
		$.ajax({
			type: "POST",
			url: "/UserManagement/Get_DropDown_UserType",
			data: "",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (response) {
				response.forEach((obj) => {

					optionValue = obj.User_Type;
					optionText = obj.User_Type;
					

					$('#usertype').append(`<option value="${optionValue}">
									  ${optionText}
								  </option>`);
				});
                Off_Loading();
			},
			failure: function (response) {
                Off_Loading();
			},
			error: function (response) {
                Off_Loading();
			}
		});
	}

	function Get_DropDown_Emp()
	{
		$.ajax({
			type: "POST",
			url: "/UserManagement/Get_DropDown_Emp",
			data: "",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (response)
			{
				response.forEach((obj) => {

					optionValue = obj.Employee_Code;
					optionText = obj.Name;
					optionType = obj.Position_Name;

					$('#emp').append(`<option value="${optionValue}">
									   [${optionType}] ${optionValue}-${optionText}
								  </option>`);
				});
			},
			failure: function (response)
			{
			},
			error: function (response)
			{
			}
		});

	}

	function Get_DropDown_UserGroup()
	{
		$.ajax({
			type: "POST",
			url: "/UserManagement/Get_DropDown_UserGroup",
			data: "",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (response)
			{
				response.forEach((obj) => {

					optionValue = obj.Position_Group;
					optionText = obj.Position_Group;
					

					$('#usergroup').append(`<option value="${optionValue}">
									   ${optionText}
								  </option>`);
				});
			},
			failure: function (response) {
			},
			error: function (response) {
			}
		});
	}

	function Get_DropDown_Position()
	{
		ClearDDPosition();
		let User_GroupID = $('#usergroup').val();

		if (User_GroupID != null && User_GroupID != "")
		{
			$.ajax({
				type: "POST",
				url: "/UserManagement/Get_DropDown_Position",
				data: { PositionGroup: User_GroupID },
				@*contentType: "application/json; charset=utf-8",*@
				dataType: "json",
				success: function (response) {

					response.forEach((obj) => {

						optionValue = obj.Position_Code;
						optionText = obj.Position_Name;


						$('#position').append(`<option value="${optionValue}">
									   ${optionText}
								  </option>`);
					});
				},
				failure: function (response) {
				},
				error: function (response) {
				}
			});
		}
		else
		{
			swal("", "Plase select UserGroup !!", "error");
		}

		
	}

	function ClearDDPosition() {
		$('#position')
			.find('option')
			.remove()
			.end()
			.append('<option value="">--Selected--</option>')
			.val('')
			;
	}


</script>

