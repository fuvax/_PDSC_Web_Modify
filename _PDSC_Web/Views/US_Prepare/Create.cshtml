
@{
	ViewBag.Title = "Create-Prepare_UpdateStatus";
}

<div class="card">
	<div class="card-header">
		<h3 style="color:black;">Stage: Prepare (Hoist Way)</h3>
	</div>

    <div class="card-body">
        @if ((ViewBag.GetRoles == "Role_US13") && (ViewBag.GetMNRoles == "PDSCPAGE003"))
        {
            using (Html.BeginForm("CreatePrepare", "US_Prepare", FormMethod.Post, new
            {
                enctype = "multipart/form-data"
            }))

            {
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">

                            <label class="text-font-13">Task Name : </label>
                        </div>
                        <div class="col-sm-3 ">

                            <label id="TaskName" style="color:red;font-weight:bold;font-size:16px;" class="text-font-12"></label>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">Working Date : </label>
                        </div>
                        <div class="col-sm-3 ">
                            <input onchange="CheckDate();" id="workingDate" name="workingDate" class="form-control" type="date" />
                        </div>
                        <div class="col-sm-3 ">
                            <label style="color:red;font-weight:bold;font-size:20px;">****</label>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">Result : </label>
                        </div>
                        <div class="col-sm-3 ">
                            <select id="result" name="result" class="form-control">
                                <option value="">--Selected--</option>
                            </select>
                        </div>
                        <div class="col-sm-3 ">
                            <label style="color:red;font-weight:bold;font-size:20px;">****</label>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">Problem : </label>
                        </div>
                        <div class="col-sm-3 ">
                            <select id="problem" name="problem" class="form-control">
                                <option value="">--Selected--</option>
                            </select>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">Problem Note : </label>
                        </div>
                        <div class="col-sm-3 ">
                            <textarea name="ProblemNote" class="form-control" rows="3"></textarea>
                        </div>

                    </div>
                </div>


               @* <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">file Image : </label>
                        </div>
                        <div class="col-sm-3">

                            <input id="uploadfile" type="file" accept="image/png,image/jpeg,.jpg" />
                            <label class="text-font-13" style="color:red;font-weight:bold;">(**Max 5 images**) </label>

                        </div>

                    </div>
                </div>*@
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                        
                        </div>
                        <div class="col-sm-3">

                            @*for resize*@
                            <img id="input1" name="input1" src="" hidden>
                            <input type="text" id="input1_src" name="input1_src" hidden />
                            <img id="output" name="output" src="" hidden>
                            <input type="text" id="output_src" name="output_src" hidden />
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-2">

                        </div>
                        <div class="col-sm-7">


                            <table>
                                <tr>
                                    <td>
                                        <div id="Div_0" class="container" style=" width:200px; height:140px;" hidden>
                                            <img id="img_0" name="img_0" src="" class="image img_size" style="border: 1px solid black; margin: 0px;" />
                                            <input type="text" id="img_file_0" name="img_file_0" hidden />
                                            <div class="middle">
                                                <a onclick="ModalPreviewPhoto(0);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                             @*   <a onclick="removePhoto(0);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>*@

                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div id="Div_1" class="container" style=" width:200px; height:140px;" hidden>
                                            <img id="img_1" name="img_1" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                            <input type="text" id="img_file_1" name="img_file_1" hidden />
                                            <div class="middle">
                                                <a onclick="ModalPreviewPhoto(1);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                               @* <a onclick="removePhoto(1);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>*@

                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div id="Div_2" class="container" style=" width:200px; height:140px;" hidden>
                                            <img id="img_2" name="img_2" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                            <input type="text" id="img_file_2" name="img_file_2" hidden />
                                            <div class="middle">
                                                <a onclick="ModalPreviewPhoto(2);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                               @* <a onclick="removePhoto(2);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>*@

                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div id="Div_3" class="container" style=" width:200px; height:140px;" hidden>
                                            <img id="img_3" name="img_3" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                            <input type="text" id="img_file_3" name="img_file_3" hidden />
                                            <div class="middle">
                                                <a onclick="ModalPreviewPhoto(3);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                               @* <a onclick="removePhoto(3);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>*@

                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div id="Div_4" class="container" style=" width:200px; height:140px;" hidden>
                                            <img id="img_4" name="img_4" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                            <input type="text" id="img_file_4" name="img_file_4" hidden />
                                            <div class="middle">
                                                <a onclick="ModalPreviewPhoto(4);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                               @* <a onclick="removePhoto(4);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>*@

                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>

                        </div>
                        <div class="col-sm-3">

                        </div>
                    </div>
                </div>

               @* <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3 text-right">
                            <label class="text-font-13">file PDF : </label>
                        </div>
                        <div class="col-sm-3">

                            <input id="uploadfilePDF" type="file" accept=".pdf" />
                            <label class="text-font-13" style="color:red;font-weight:bold;">(**Max 5 files**) </label>
                        </div>

                    </div>
                </div>*@

                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-2">

                        </div>
                        <div class="col-sm-7">



                            <div id="DIV_PDF_0" hidden>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                        </span>
                                        <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                            <a id="filenamePDF_0" href=""
                                               style="font-weight:bold;color:black;font-size:20px;" download></a>
                                            <input id="file_0" name="file_0" type="text" hidden />
                                            <input id="filename_0" name="filename_0" type="text" hidden />
                                        </div>

                                    </div>
                                    <div style="border:0px solid black;width:40px;">
                                       @* <a onclick="removefile(0);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                            <i class="fas fa-times" style="margin:7px;"></i>
                                        </a>*@
                                    </div>
                                </div>
                            </div><br />
                            <div id="DIV_PDF_1" hidden>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                        </span>
                                        <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                            <a id="filenamePDF_1" href=""
                                               style="font-weight:bold;color:black;font-size:20px;" download></a>
                                            <input id="file_1" name="file_1" type="text" hidden />
                                            <input id="filename_1" name="filename_1" type="text" hidden />
                                        </div>

                                    </div>
                                    <div style="border:0px solid black;width:40px;">
                                       @* <a onclick="removefile(1);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                            <i class="fas fa-times" style="margin:7px;"></i>
                                        </a>*@
                                    </div>
                                </div>
                            </div><br />
                            <div id="DIV_PDF_2" hidden>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                        </span>
                                        <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                            <a id="filenamePDF_2" href=""
                                               style="font-weight:bold;color:black;font-size:20px;" download></a>
                                            <input id="file_2" name="file_2" type="text" hidden />
                                            <input id="filename_2" name="filename_2" type="text" hidden />
                                        </div>

                                    </div>
                                    <div style="border:0px solid black;width:40px;">
                                      @*  <a onclick="removefile(2);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                            <i class="fas fa-times" style="margin:7px;"></i>
                                        </a>*@
                                    </div>
                                </div>
                            </div><br />
                            <div id="DIV_PDF_3" hidden>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                        </span>
                                        <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                            <a id="filenamePDF_3" href=""
                                               style="font-weight:bold;color:black;font-size:20px;" download></a>
                                            <input id="file_3" name="file_3" type="text" hidden />
                                            <input id="filename_3" name="filename_3" type="text" hidden />
                                        </div>

                                    </div>
                                    <div style="border:0px solid black;width:40px;">
                                      @*  <a onclick="removefile(3);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                            <i class="fas fa-times" style="margin:7px;"></i>
                                        </a>*@
                                    </div>
                                </div>
                            </div><br />
                            <div id="DIV_PDF_4" hidden>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                        </span>
                                        <div class="text-center" style="border:1px dashed grey;max-height:50px;width:300px;margin-left:2px;">
                                            <a id="filenamePDF_4" href=""
                                               style="font-weight:bold;color:black;font-size:20px;" download></a>
                                            <input id="file_4" name="file_4" type="text" hidden />
                                            <input id="filename_4" name="filename_4" type="text" hidden />
                                        </div>

                                    </div>
                                    <div style="border:0px solid black;width:40px;">
                                      @*  <a onclick="removefile(4);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                            <i class="fas fa-times" style="margin:7px;"></i>
                                        </a>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">

                        </div>
                    </div>
                </div>

                <div class="col-md-12">
                    <div class="form-group row">
                        <div class="col-sm-3">

                        </div>
                        <div class="col-md-12 text-center">
                            <button id="SaveBtn" type="submit" hidden>save</button>
                        </div>

                    </div>
                </div>
            </div>
            }

            <div class="col-md-12 text-center" style="margin-bottom:25px;">
                <button onclick="Save();" class="mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn btn-outline-success">
                    <i class="fas fa-save"></i>
                    SAVE
                </button>
            </div>
        }
        else
        {
            <label style="color:red; font-weight:bold; font-size: larger">Please contact staff for set roles</label>
        }

    </div>

</div>
<script src="~/ThridParty/Theam/ArchitectUI-Pro/assets/core/jquery.min.js" type="text/javascript"></script>
<script src="~/lib/datatables.net-bs4/dataTables.bootstrap4.min.js"></script>
<script src="~/lib/select2/js/select2.min.js"></script>
<script src="~/lib/moment.js/moment.min.js"></script>
<script>
	$.fn.select2.defaults.set("theme", "bootstrap");

	$('#problem').select2();
	$('#result').select2();

	$(document).ready(() =>
    {
        On_Loading();
		Show_backbtn();
		var Taskname = '@Session["TaskName"]';
		$('#TaskName').text(Taskname);
		GetDD_ResultDate();
		GetDD_Problem();
        lockButton();
        
	});

	function CheckDate()
	{
		let workingdate = new Date($('#workingDate').val());
		let dateNow = new Date();

		if (workingdate > dateNow)
		{
			swal("", "You can't choose Working Date more than today.", "error");
			$('#workingDate').val('');
		}

	}



	function lockButton() {
		var Stage = '@Session["Stage"]';
        var IsRole = '@Session["GoSubmit"]';

		disable_stage(Stage, IsRole);

		@*$('#filenamePDF_0').text('Filepdf.pdf');
		$('#filenamePDF_0').attr('href','../ThridParty/icon/pdf_icon.png');*@
        

	}

	function Save() {
		var msg = "Please Enter ";

        if ($('#workingDate').val() == "" || $('#workingDate').val() == null)
        {
			msg = msg + " Working Date  ";
		}

		if ($('#result').val() == "" || $('#result').val() == null) {
			msg = msg + "  Result";
		}

		swal({
			title: "",
            text: "Are you sure? Do you want to save it?",
			type: "warning",
			showCancelButton: true,
			confirmButtonColor: "#DD6B55",
			confirmButtonText: "Yes",
			cancelButtonText: "No",
			closeOnConfirm: false,
			closeOnCancel: false
		},
			function (isConfirm) {
				if (isConfirm) {
					//working date , result,problem
					if (($('#workingDate').val() != "" && $('#workingDate').val() != null) &&
						($('#result').val() != "" && $('#result').val() != null)) {
						$('#SaveBtn').trigger('click');
					}
					else {
						swal("", msg, "error");
					}

				}
				else {

					swal("", "Cancelled", "error");
				}
			});

	}

	function ModalPreviewPhoto(id)
	{
		var ResoreUrl;
		var url = "";
		if (url == null || url == "" || url == "null")
		{
			ResoreUrl = "/Resoure/Picture/_NoImg.png";
		}
		else {
			ResoreUrl = url;
		}

		switch (id)
		{
			case 0: ResoreUrl = $('#img_0').attr('src');  ; break;
			case 1: ResoreUrl = $('#img_1').attr('src'); ; break;
			case 2: ResoreUrl = $('#img_2').attr('src'); ; break;
			case 3: ResoreUrl = $('#img_3').attr('src'); ; break;
			case 4: ResoreUrl = $('#img_4').attr('src'); ; break;
		}


		$('#PreviewImg').attr('src', ResoreUrl);
		$('#ViewPicture').modal('show');

	}

	function CloseModal()
	{
		$('#ViewPicture').modal('hide');
	}

	function GetDD_ResultDate()
    {
        //On_Loading();
			$.ajax({
				type: "POST",
				url: "/US_Prepare/GetDropDownResult",
				data: "",
				@*contentType: "application/json; charset=utf-8",*@
				dataType: "json",
				success: function (response)
				{

					response.forEach((obj) => {

						optionValue = obj.Result_Code;
						optionText = obj.Result_Name;
						$('#result').append(`<option value="${optionValue}">
									   ${optionText}
								  </option>`);
					});

				},
				failure: function (response) {
				},
				error: function (response) {
				}
			});
        
	}
	function GetDD_Problem()
    {
        
		$.ajax({
			type: "POST",
			url: "/US_Prepare/GetDropDownProblem",
			data: "",
		@*	contentType: "application/json; charset=utf-8",*@
			dataType: "json",
			success: function (response)
			{
				response.forEach((obj) => {

					optionValue = obj.Problem_Code;
					optionText = obj.Problem_Name;
					$('#problem').append(`<option value="${optionValue}">
									  ${optionValue}-${optionText}
								  </option>`);
				});
                Off_Loading();

			},
            failure: function (response) {
                Off_Loading();
			},
            error: function (response) {
                Off_Loading();
			}
        });
        
	}
</script>


