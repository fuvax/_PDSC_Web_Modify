
@{
	ViewBag.Title = "CreateRectifyResult";
}

    <div class="card-hover-shadow-2x card-border card">
        <div class="card-header">
            <h2 style="color:black;">Rectify Result</h2>
        </div>
        @if ((ViewBag.GetRoles == "Role_US36") && (ViewBag.GetMNRoles == "PDSCPAGE003"))
        {
            using (Html.BeginForm("Edit_Rectify_Result", "ProjectUpdateStatus", FormMethod.Post, new { }))
            {
                <div class="card-body">

                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Defect Item : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input id="DT_Code" name="DT_Code" type="text" hidden />

                                <input type="text" id="DefectItem" name="DefectItem" class="text-font-12" hidden />
                                <label id="DefectItemText" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Rank : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input id="Rank" name="Rank" class="text-font-12" hidden />
                                <label id="RankText" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Issue Date : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input type="text" id="IssueDate" name="IssueDate" class="text-font-12" hidden />
                                <label id="IssueDateText" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Issue By : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input type="text" id="IssueBy" name="IssueBy" class="text-font-12" hidden />
                                <label id="IssueByText" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">In Charge Person : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <label id="InChargePersonText" class="text-font-12"></label>
                                <input type="text" id="InChargePerson" name="InChargePerson" hidden />
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Responsibility : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <label id="ResponsibilityText" class="text-font-12"></label>
                                <input type="text" id="Responsibility" name="Responsibility" hidden />
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Cause : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <label id="CaseText" class="text-font-12"></label>
                                <input type="text" id="Case" name="Case" hidden />
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>

                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Note Defect : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input type="text" id="NoteDefect" name="NoteDefect" class="text-font-12" hidden />
                                <label id="NoteDefectText" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13">Plan Rectify Finish : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <label id="PlanRectify" class="text-font-13"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>

                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13" style="font-weight:bold;color:black;">Rectify Complete Date : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <input onchange="CheckDate();" id="RetifyDate" name="RetifyDate" type="date" class="form-control" />
                            </div>
                            <div class="col sm-3">
                                <label style="color:red;font-weight:bold;font-size:20px;">****</label>                                
                            </div>
                            <div class="col sm-3">

                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">

                            </div>
                            <div class="col sm-5 text-left">
                                <label style="color:red;font-weight:initial;font-size:13px;">(Rectify Complete Date >= Issue Date and Rectify Complete Date <= Today)</label>
                            </div>
                            <div class="col sm-2">

                            </div>
                            <div class="col sm-2">

                            </div>

                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13" style="font-weight:bold;color:black;">Rectify Result : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <select id="RectifyResult" name="RectifyResult" class="form-control">
                                    <option value="">--Selected--</option>
                                </select>
                            </div>
							<div class="col sm-3">
								<label style="color:red;font-weight:bold;font-size:20px;">****</label>
							</div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13" style="font-weight:bold;color:black;">Note Rectify Result : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <textarea id="NoteRectify" name="NoteRectify" class="form-control"></textarea>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>
                    <div class="col md-12">
                        <div class="row form-group">
                            <div class="col sm-3 text-right">
                                <label class="text-font-13" style="font-weight:bold;color:red;">Rectify by : </label>
                            </div>
                            <div class="col sm-3 text-left">
                                <label class="text-font-12"></label>
                            </div>
                            <div class="col sm-3">
                            </div>
                            <div class="col sm-3">
                            </div>
                        </div>
                    </div>

                    <!---
                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-3 text-right">
                                <label class="text-font-13">Image : </label>
                            </div>
                            <div class="col-sm-3">

                                <input id="uploadfile" type="file" accept="image/png,image/jpeg,.jpg" />
                                <label class="text-font-13" style="color:red;font-weight:bold;">(**Max 5 image**) </label>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-3 text-right">
                        
                            </div>
                            <div class="col-sm-3">

                                @*for resize*@
                                <img id="input1" name="input1" src="" hidden>
                                <input type="text" id="input1_src" name="input1_src" hidden />
                                <img id="output" name="output" src="" hidden>
                                <input type="text" id="output_src" name="output_src" hidden />
                            </div>

                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-2">

                            </div>
                            <div class="col-sm-7">


                                <table>
                                    <tr>
                                        <td>
                                            <div id="Div_0" class="container" style=" width:200px; height:140px;" hidden>
                                                <img id="img_0" name="img_0" src="" class="image img_size" style="border: 1px solid black; margin: 0px;" />
                                                <input type="text" id="img_file_0" name="img_file_0" hidden />
                                                <input type="text" id="Img_ID_0" hidden />
                                                <input type="text" id="img_delete_0" name="img_delete_0" hidden />
                                                <div class="middle">
                                                    <a onclick="ModalPreviewPhoto(0);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a onclick="removePhoto(0);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>

                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div id="Div_1" class="container" style=" width:200px; height:140px;" hidden>
                                                <img id="img_1" name="img_1" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                                <input type="text" id="img_file_1" name="img_file_1" hidden />
                                                <input type="text" id="Img_ID_1" hidden />
                                                <input type="text" id="img_delete_1" name="img_delete_1" hidden />
                                                <div class="middle">
                                                    <a onclick="ModalPreviewPhoto(1);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a onclick="removePhoto(1);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>

                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div id="Div_2" class="container" style=" width:200px; height:140px;" hidden>
                                                <img id="img_2" name="img_2" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                                <input type="text" id="img_file_2" name="img_file_2" hidden />
                                                <input type="text" id="Img_ID_2" hidden />
                                                <input type="text" id="img_delete_2" name="img_delete_2" hidden />
                                                <div class="middle">
                                                    <a onclick="ModalPreviewPhoto(2);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a onclick="removePhoto(2);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>

                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div id="Div_3" class="container" style=" width:200px; height:140px;" hidden>
                                                <img id="img_3" name="img_3" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                                <input type="text" id="img_file_3" name="img_file_3" hidden />
                                                <input type="text" id="Img_ID_3" hidden />
                                                <input type="text" id="img_delete_3" name="img_delete_3" hidden />
                                                <div class="middle">
                                                    <a onclick="ModalPreviewPhoto(3);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a onclick="removePhoto(3);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>

                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div id="Div_4" class="container" style=" width:200px; height:140px;" hidden>
                                                <img id="img_4" name="img_4" src="" class="image img_size" style="border: 1px solid black; margin: 0px;">
                                                <input type="text" id="img_file_4" name="img_file_4" hidden />
                                                <input type="text" id="Img_ID_4" hidden />
                                                <input type="text" id="img_delete_4" name="img_delete_4" hidden />
                                                <div class="middle">
                                                    <a onclick="ModalPreviewPhoto(4);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-success">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a onclick="removePhoto(4);" class="btn-remove mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn-lg btn btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>

                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                            <div class="col-sm-3">

                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-3 text-right">
                                <label class="text-font-13">file PDF : </label>
                            </div>
                            <div class="col-sm-3">

                                <input id="uploadfilePDF" type="file" accept=".pdf" />
                                <label class="text-font-13" style="color:red;font-weight:bold;">(**Max 5 image**) </label>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-2">

                            </div>
                            <div class="col-sm-7">



                                <div id="DIV_PDF_0" hidden>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                            </span>
                                            <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                                <a id="filenamePDF_0" href=""
                                                   style="font-weight:bold;color:black;font-size:20px;" download></a>
                                                <input id="file_0" name="file_0" type="text" hidden />
                                                <input id="fileID_0" name="file_0" type="text" hidden />
                                                <input id="filename_0" name="filename_0" type="text" hidden />
                                                <input id="filedelete_0" name="filedelete_0" type="text" hidden />
                                                <input id="filedeletename_0" name="filedeletename_0" type="text" hidden />
                                            </div>

                                        </div>
                                        <div style="border:0px solid black;width:40px;">
                                            <a onclick="removefile(0);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                                <i class="fas fa-times" style="margin:7px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div><br />
                                <div id="DIV_PDF_1" hidden>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                            </span>
                                            <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                                <a id="filenamePDF_1" href=""
                                                   style="font-weight:bold;color:black;font-size:20px;" download></a>
                                                <input id="file_1" name="file_1" type="text" hidden />
                                                <input id="fileID_1" name="file_0" type="text" hidden />
                                                <input id="filename_1" name="filename_1" type="text" hidden />
                                                <input id="filedelete_1" name="filedelete_1" type="text" hidden />
                                                <input id="filedeletename_1" name="filedeletename_1" type="text" hidden />
                                            </div>

                                        </div>
                                        <div style="border:0px solid black;width:40px;">
                                            <a onclick="removefile(1);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                                <i class="fas fa-times" style="margin:7px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div><br />
                                <div id="DIV_PDF_2" hidden>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                            </span>
                                            <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                                <a id="filenamePDF_2" href=""
                                                   style="font-weight:bold;color:black;font-size:20px;" download></a>
                                                <input id="file_2" name="file_2" type="text" hidden />
                                                <input id="fileID_2" name="file_0" type="text" hidden />
                                                <input id="filename_2" name="filename_2" type="text" hidden />
                                                <input id="filedelete_2" name="filedelete_2" type="text" hidden />
                                                <input id="filedeletename_2" name="filedeletename_2" type="text" hidden />
                                            </div>

                                        </div>
                                        <div style="border:0px solid black;width:40px;">
                                            <a onclick="removefile(2);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                                <i class="fas fa-times" style="margin:7px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div><br />
                                <div id="DIV_PDF_3" hidden>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                            </span>
                                            <div class="text-center" style="border:1px dashed grey;width:300px;margin-left:2px;">
                                                <a id="filenamePDF_3" href=""
                                                   style="font-weight:bold;color:black;font-size:20px;" download></a>
                                                <input id="file_3" name="file_3" type="text" hidden />
                                                <input id="fileID_3" name="file_0" type="text" hidden />
                                                <input id="filename_3" name="filename_3" type="text" hidden />
                                                <input id="filedelete_3" name="filedelete_3" type="text" hidden />
                                                <input id="filedeletename_3" name="filedeletename_3" type="text" hidden />
                                            </div>

                                        </div>
                                        <div style="border:0px solid black;width:40px;">
                                            <a onclick="removefile(3);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                                <i class="fas fa-times" style="margin:7px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div><br />
                                <div id="DIV_PDF_4" hidden>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img src="~/ThridParty/icon/pdf_icon.png" style="width:auto;height:25px;" />
                                            </span>
                                            <div class="text-center" style="border:1px dashed grey;max-height:50px;width:300px;margin-left:2px;">
                                                <a id="filenamePDF_4" href=""
                                                   style="font-weight:bold;color:black;font-size:20px;" download></a>
                                                <input id="file_4" name="file_4" type="text" hidden />
                                                <input id="fileID_4" name="file_0" type="text" hidden />
                                                <input id="filename_4" name="filename_4" type="text" hidden />
                                                <input id="filedelete_4" name="filedelete_4" type="text" hidden />
                                                <input id="filedeletename_4" name="filedeletename_4" type="text" hidden />
                                            </div>

                                        </div>
                                        <div style="border:0px solid black;width:40px;">
                                            <a onclick="removefile(4);" class="btn-sm btn btn-outline-danger btn-shadow btn-outline-2x" style="margin-left:2px;">
                                                <i class="fas fa-times" style="margin:7px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-3">

                            </div>
                        </div>
                    </div>
                    ---->

                    <div class="col md-12 text-center">
                        <button id="SaveBtn" type="submit" hidden>save</button>
                    </div>

                </div>
            }
            <div class="col-md-12 text-center" style="margin-bottom:25px;">
                <button onclick="Save();" class="mb-2 mr-2 btn-icon btn-icon-only btn-shadow btn-outline-2x btn btn-outline-success">
                    <i class="fas fa-save"></i>
                    SAVE
                </button>
            </div>
        }
        else
        {
            <div class="card-body">
                <label style="color:red; font-weight:bold; font-size: larger">Please contact staff for set roles</label>
            </div>
        }
    </div>
	@*<a id="btn_back" onclick="Back_Button();" class="float pointer" style="color:white;">
		<i class="fas fa-arrow-left B-icon"></i>
	</a>*@
    <a href="@Url.Action("Defect", "ProjectUpdateStatus")" class="float pointer" style="color:white;">
        <i class="fas fa-arrow-left B-icon"></i>
    </a>
	<script src="~/ThridParty/Theam/ArchitectUI-Pro/assets/core/jquery.min.js" type="text/javascript"></script>
	<script src="~/lib/datatables.net-bs4/dataTables.bootstrap4.min.js"></script>
	<script src="~/lib/moment.js/moment.min.js"></script>
	<script src="~/lib/select2/js/select2.min.js"></script>
	<script>
		$.fn.select2.defaults.set("theme", "bootstrap");

		$('#RectifyResult').select2();

		var olddata;
		$(document).ready(() =>
		{
			On_Loading();
			SetUp();

		});

		function SetUp()
		{
			Get_DefectItem();
			Get_Data();
			Get_Rectify_Result();

        }

		function CheckDate() {
			let workingdate = new Date($('#RetifyDate').val());
            let dateNow = new Date();
            let issuedate = new Date($('#IssueDate').val());
            //console.log("issuedate: " + issuedate);

            if (workingdate > dateNow) {
                swal("", "You must choose Rectify Complete Data < or = today.", "error");
                $('#RetifyDate').val('');

            }
            else if (workingdate < issuedate) {
                swal("", "You must choose Rectify Complete Data > or = Issue Date.", "error");
                $('#RetifyDate').val('');
            }

		}

        function Save()
        {
			var msg = "Please Enter ";

			if ($('#RectifyResult').val() == "" || $('#RectifyResult').val() == null)
            {
				msg = msg + " Rectify-Result ";
            }

			if ($('#RetifyDate').val() == "" || $('#RetifyDate').val() == null) {
				msg = msg + " Retify-Date ";
			}


			swal({
				title: "",
                text: "Are you sure? Do you want to save it?",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "Yes",
				cancelButtonText: "No",
				closeOnConfirm: false,
				closeOnCancel: false
			},
				function (isConfirm) {
					if (isConfirm) {
						if (($('#RectifyResult').val() != "" && $('#RectifyResult').val() != null) &&
                            ($('#RetifyDate').val() != "" && $('#RetifyDate').val() != null))/*&&
							($('#NoteRectify').val() != "" && $('#NoteRectify').val() != null))*/
						{
							$('#SaveBtn').trigger('click');
						}
						else {
							swal("", msg, "error");
						}

					}
					else {

                        swal("", "Cancelled", "error");
					}
				});

		}

		$("#uploadfilePDF").change(function () {
		PDF_Preview(this);
	});

		function PDF_Preview(input) {
			var name = input.files[0].name;

			if (name.endsWith(".pdf")) {
				if (input.files && input.files[0]) {
					var reader = new FileReader();

					reader.onload = function (e) {
						if ($('#filenamePDF_0').attr('href') == "") {

							$('#filenamePDF_0').attr('href', e.target.result);
							$('#filenamePDF_0').text(name);
							$('#filenamePDF_0').attr('download', name);
							$('#DIV_PDF_0').removeAttr('hidden');

							$('#file_0').val(e.target.result);
							$('#filename_0').val(name);
						}
						else if ($('#filenamePDF_1').attr('href') == "") {
							$('#filenamePDF_1').attr('href', e.target.result);
							$('#filenamePDF_1').text(name);
							$('#filenamePDF_1').attr('download', name);
							$('#DIV_PDF_1').removeAttr('hidden');

							$('#file_1').val(e.target.result);
							$('#filename_1').val(name);
						}
						else if ($('#filenamePDF_2').attr('href') == "") {
							$('#filenamePDF_2').attr('href', e.target.result);
							$('#filenamePDF_2').text(name);
							$('#filenamePDF_2').attr('download', name);
							$('#DIV_PDF_2').removeAttr('hidden');

							$('#file_2').val(e.target.result);
							$('#filename_2').val(name);
						}
						else if ($('#filenamePDF_3').attr('href') == "") {
							$('#filenamePDF_3').attr('href', e.target.result);
							$('#filenamePDF_3').text(name);
							$('#filenamePDF_3').attr('download', name);
							$('#DIV_PDF_3').removeAttr('hidden');

							$('#file_3').val(e.target.result);
							$('#filename_3').val(name);
						}
						else if ($('#filenamePDF_4').attr('href') == "") {
							$('#filenamePDF_4').attr('href', e.target.result);
							$('#filenamePDF_4').text(name);
							$('#filenamePDF_4').attr('download', name);
							$('#DIV_PDF_4').removeAttr('hidden');

							$('#file_4').val(e.target.result);
							$('#filename_4').val(name);
						}
						else {
							alert("You can only upload a maximum of 5 images");
						}
					}

					reader.readAsDataURL(input.files[0]); // convert to base64 string
				}
			}
			else {
				swal("", "The file format not support, Please you choose file pdf type only", "error");
			}


			$("#uploadfilePDF").val("");
		}

		function removefile(id)
		{

			var MainUrl = new Array();
			var listname = new Array();

			var ListID = new Array();
			var List_souru = new Array();


			var ListDelete = new Array();
			var ListDelete_name = new Array();

			for (var i = 0; i < 5; i++)
			{

				if ($('#filenamePDF_' + i).attr('href') != "")
				{
					MainUrl.push($('#filenamePDF_' + i).attr('href'));
					listname.push($('#filenamePDF_' + i).text());

					if ($('#fileID_' + i).val() != "" && $('#fileID_' + i).val() != null)
					{
						ListID.push($('#fileID_' + i).val());
						List_souru.push($('#filenamePDF_' + i).attr('href'));


						if (i == id)
						{
							ListDelete.push($('#fileID_' + i).val());
							ListDelete_name.push($('#filename_' + i).val());
						}


					}

				}
			}

			//hide last index
			var LastIndexDiv = MainUrl.length - 1;

			$('#DIV_PDF_' + LastIndexDiv).attr('hidden', 'hidden');


			var model =
			{
				ID: id,
				List_source: MainUrl,
				List_name: listname,
				List_source_text: List_souru ,
				ListDelete: ListDelete,
				ListDelete_name: ListDelete_name,
				List_ID: ListID
			};

			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/RemoveFile_From_Database",
				data: model,
				dataType: "json",
				success: function (response) {

					ClearSrcFile();



					for (var i = 0; i < response[0].List_source.length; i++)
					{

						$('#filenamePDF_' + i).attr('href', response[0].List_source[i]);
						$('#filenamePDF_' + i).text(response[0].List_name[i]);
						$('#file_' + i).val(response[0].List_source[i]);
					}



					for (var i = 0; i < response[0].List_ID.length; i++) {

						$('#fileID_' + i).val(response[0].List_ID[i]);
						$('#file_' + i).val("");

					}

					for (var i = 0; i < response[0].List_name.length; i++)
					{

						$('#filename_' + i).val(response[0].List_name[i]);
						//$('#img_file_' + i).val("");
					}

					//Delete image from DB
					for (var i = 0; (i < 5 && response[0].ListDelete.length != null); i++)
					{

						if ($('#filedelete_' + i).val() == null || $('#filedelete_' + i).val() == "")
						{
							$('#filedelete_' + i).val(response[0].ListDelete[0]);
							break;
						}

					}

					for (var i = 0; (i < 5 && response[0].ListDelete_name.length != null); i++)
					{

						if ($('#filedeletename_' + i).val() == null || $('#filedeletename_' + i).val() == "")
						{
							$('#filedeletename_' + i).val(response[0].ListDelete_name[0]);
							break;
						}

					}


				},
				failure: function (response)
				{
					console.log(response);
				},
				error: function (response) {
					console.log(response);
				}
			});
		}

		function GetFileData()
		{
			//var TT_Code = '@Session["TT_Code"]';
			var TT_Code = '@Session["DT_Code"]';
			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/Edit_GetFile",
				data: JSON.stringify({ 'TransectionCode': TT_Code }),
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (response)
				{
					if ((response != null && response != "")) {

						for (var i = 0; i < response.length; i++)
						{
								var file = "file_" + i;
								var filename = `filename_` + i;

								var fileID = `fileID_`+i;

								var filenamePDF = "filenamePDF_" + i;

								$('#DIV_PDF_' + i).removeAttr('hidden');

								document.getElementById(filenamePDF).href = response[i].ImgT_FileData;
								document.getElementById(filenamePDF).innerHTML = response[i].ImgT_FileName;

								//document.getElementById(file).value = response[i].ImgT_FileData;
								//document.getElementById(filename).value = response[i].ImgT_FileName;

								document.getElementById(fileID).value = response[i].ImgT_Code;

						}



					}

				},
				failure: function (response) {
					console.log("failure" + response.responseText);
				},
				error: function (response) {
					console.log("error" + response.responseText);
				}
			});
			Off_Loading();

		}

		function Get_Rectify_Result()
		{
			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/Get_DropDown_RectifyResult",
				data: "",
				dataType: "json",
				success: function (response) {


					response.forEach((obj) => {

						optionValue = obj.DRR_Code;
						optionText = obj.DRR_Description;

						$('#RectifyResult').append(`<option value="${optionValue}">
										  ${optionText}
									  </option>`);
					});
				},
				failure: function (response) {
					console.log(response.responseText);
				},
				error: function (response) {
					console.log(response.responseText);
				}

			});
		}

		function GetImgData()
		{
			//var TT_Code = '@Session["TT_Code"]';
			var TT_Code = '@Session["DT_Code"]';
			$.ajax({
				type: "POST",
                url: "/ProjectUpdateStatus/Edit_GetImg",
				data: JSON.stringify({ 'TransectionCode': TT_Code }),
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (response)
				{
					if ((response != null && response != ""))
					{

						for (var i = 0; i < response.length;i++)
						{
							var img = "img_" + i;
							var img_file = "img_file_" + i;
							var Img_ID = "Img_ID_" + i;

							$('#Div_' + i).removeAttr('hidden');

							//console.log(response);
							document.getElementById(img).src = response[i].ImgT_FileData;
							document.getElementById(Img_ID).value  = response[i].ImgT_Code;



						}

					}
				},
				failure: function (response) {
					console.log("failure" + response.responseText);
				},
				error: function (response) {
					console.log("error" + response.responseText);
				}
			});
		}

		function Get_Data()
		{
			var DT_Code = "@Session["DT_Code"]";
			$('#DT_Code').val(DT_Code);


			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/Get_Data_By_DT_Code",
				data: { DT_Code: DT_Code },
				dataType: "json",
				success: function (response)
                {
                    if (response.code === 1) {
                        window.location = '/Login/Logout';
                    }
                    else {
                        olddata

                        $('#Rank').val(response[0].DT_Rank);
                        $('#RankText').text(response[0].DT_Rank);
                        $('#IssueDate').val(moment(response[0].DT_Issue_Date).format("DD-MMM-YYYY"));
                        $('#IssueDateText').text(moment(response[0].DT_Issue_Date).format("DD-MMM-YYYY"));
                        $('#IssueBy').text(response[0].DT_Issue_by);
                        $('#IssueByText').text(response[0].DT_Issue_by);
                        $('#NoteDefect').val(response[0].DT_Note_Defect);
                        $('#NoteDefectText').text(response[0].DT_Note_Defect);
                        //$('#PlanRectify').text(moment(response[0].DT_Plan_Rectify_Finish).format("DD-MMM-YYYY"));
                        if (moment(response[0].DT_Plan_Rectify_Finish).format("DD-MM-YYYY") == "01-01-9999") {
                            $('#PlanRectify').text("N/A");
                        }
                        else {
                            $('#PlanRectify').text(moment(response[0].DT_Plan_Rectify_Finish).format("DD-MMM-YYYY"));
                        }

                        GetDropDown_InChargePerson(response[0].DICP_Code);
                        GetDropDown_Responsibility(response[0].DResp_Code, response[0].DCause_Code);

                        GetImgData();
                        GetFileData();
                    }
				},
                failure: function (response) {
                    console.log(response.responseText);
				},
				error: function (response) {
					console.log(response.responseText);
				}

			});


		}

		function Get_DefectItem()
		{
			var item_Code = "@Session["Item_Code"]"
		//	On_Loading();
			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/Get_DefectItem",
				data: { Defect_Item_Code: item_Code },
					dataType: "json",
					success: function (response)
					{
                        if (response.code === 1) {
                            window.location = '/Login/Logout';
                        }
                        else {
                            $('#DefectItem').val(response[0].Item_No);
                            $('#DefectItemText').text(response[0].Item_Description);
                        }
					},
				failure: function (response) {
					alert(response.responseText);
				},
				error: function (response) {
					alert(response.responseText);
				}

			});
		}

		function GetDropDown_InChargePerson(DICP_Code) {
			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/GetDropDown_InChargePerson",
				data: "",
				dataType: "json",
				success: function (response) {


					if (response != null && DICP_Code != "") {

						for (var i = 0; i < response.length; i++) {

							optionValue = response[i].DICP_Code;
							optionText = response[i].DICP_Description;


							if (DICP_Code == optionValue) {

								$('#InChargePerson').val(optionValue);
								$('#InChargePersonText').text(optionText);
							}
						}


					}


				},
				failure: function (response) {
					alert(response.responseText);
				},
				error: function (response) {
					alert(response.responseText);
				}

			});
		}
		function GetDropDown_Responsibility(Resp_Code, Case_Code) {
			$.ajax({
				type: "POST",
				url: "/ProjectUpdateStatus/GetDropDown_Responsibility",
				data: "",
				dataType: "json",
				success: function (response)
				{

					if (response != null && response != "") {

						for (var i = 0; i < response.length; i++) {

							optionValue = response[i].DResp_Code;
							optionText = response[i].DResp_Description;
							@*$('#Responsibility').append(`<option value="${optionValue}">
										   ${optionText}
									  </option>`);*@

							if (Resp_Code == optionValue)
							{
								$('#Responsibility').val(optionValue);
								$('#ResponsibilityText').text(optionText);
							}
						}


					}

					//Case_Code
					GetDropDown_Case(Case_Code);
				},
				failure: function (response) {
					alert(response.responseText);
				},
				error: function (response) {
					alert(response.responseText);
				}

			});
			Off_Loading();
		}
		function GetDropDown_Case(Case_Code)
		{
			//On_Loading();

			var dresp_code = $('#Responsibility').val();


				$.ajax({
					type: "POST",
					url: "/ProjectUpdateStatus/GetDropDown_Case",
					data: { DResp_Code: dresp_code },
					dataType: "json",
					success: function (response) {



						if (response != null && response != "") {

							for (var i = 0; i < response.length; i++) {

								optionValue = response[i].DCause_Code;
								optionText = response[i].DCause_Description;


								if (Case_Code == optionValue) {


									$("#Case").val(optionValue);
									$("#CaseText").text(optionText);
								}
							}


						}

					},
					failure: function (response) {
						alert(response.responseText);
					},
					error: function (response) {
						alert(response.responseText);
					}

				});
				Off_Loading();

		}

		//
		function ModalPreviewPhoto(id) {
			var ResoreUrl;
			var url = "";
			if (url == null || url == "" || url == "null") {
				ResoreUrl = "/Resoure/Picture/_NoImg.png";
			}
			else {
				ResoreUrl = url;
			}

			switch (id) {
				case 0: ResoreUrl = $('#img_0').attr('src');; break;
				case 1: ResoreUrl = $('#img_1').attr('src');; break;
				case 2: ResoreUrl = $('#img_2').attr('src');; break;
				case 3: ResoreUrl = $('#img_3').attr('src');; break;
				case 4: ResoreUrl = $('#img_4').attr('src');; break;
			}


			$('#PreviewImg').attr('src', ResoreUrl);
			$('#ViewPicture').modal('show');

		}

        function resizeImage() {
            var filesToUploads = document.getElementById("uploadfile").files;
            var file = filesToUploads[0];
            var out_img = $('#output_src').val('');
            if (file) {
                var reader = new FileReader();

                // Set the image for the FileReader
                reader.onload = function (e) {
                    var img = document.createElement("img");
                    img.src = e.target.result;

                    // Create your canvas
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    ctx.drawImage(img, 0, 0);

                    var MAX_WIDTH = 250;
                    var MAX_HEIGHT = 300;
                    var width = img.width;
                    var height = img.height;

                    // Add the resizing logic
                    if (width > height) {
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                    } else {
                        if (height > MAX_HEIGHT) {
                            width *= MAX_HEIGHT / height;
                            height = MAX_HEIGHT;
                        }
                    }

                    //Specify the resizing result
                    canvas.width = width;
                    canvas.height = height;
                    var ctx = canvas.getContext("2d");
                    ctx.drawImage(img, 0, 0, width, height);

                    dataurl = canvas.toDataURL(file.type);
                    document.getElementById("output").src = dataurl;
                    $('#output_src').val(dataurl);
                    out_img = $('#output_src').val();
                    console.log("reimg: " + out_img);

                    if ($('#img_0').attr('src') == "") {

                        $('#img_0').attr('src', out_img);
                        $('#Div_0').removeAttr('hidden');

                        $('#img_file_0').val(out_img);
                    }
                    else if ($('#img_1').attr('src') == "") {
                        $('#img_1').attr('src', out_img);
                        $('#Div_1').removeAttr('hidden');

                        $('#img_file_1').val(out_img);
                    }
                    else if ($('#img_2').attr('src') == "") {
                        $('#img_2').attr('src', out_img);
                        $('#Div_2').removeAttr('hidden');

                        $('#img_file_2').val(out_img);
                    }
                    else if ($('#img_3').attr('src') == "") {
                        $('#img_3').attr('src', out_img);
                        $('#Div_3').removeAttr('hidden');

                        $('#img_file_3').val(out_img);
                    }
                    else if ($('#img_4').attr('src') == "") {
                        $('#img_4').attr('src', out_img);
                        $('#Div_4').removeAttr('hidden');

                        $('#img_file_4').val(out_img);
                    }
                    else {
                        alert("You can only upload a maximum of 5 images");
                    }

                };
                reader.readAsDataURL(file);

            }
            else {
                swal("", "The file format not support, Please you choose file type is png, jpg or jpeg only", "error");
            }

            $('#input1').attr('src', '');
            $('#output').attr('src', '');
            $('#input1_src').val("");
            $('#output_src').val("");
            $("#uploadfile").val("");
        }

        $("#uploadfile").change(function () {
            //1048576 byte = 1 MB
            if (this.files[0].size > 1048576) {
                //alert("File is too big!");
                //this.value = "";
                var files = event.target.files;
                var file = files[0];

                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById("input1").src = e.target.result;
                        $('#input1_src').val(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
                resizeImage();

            }

            else {

                Preview(this);
            }

        });

        function removePhoto(id)      //id ---> index
        {

            var myList = new Array();
            var ListID = new Array();
            var ListDelete = new Array();

            for (var i = 0; i < 5; i++) {
                //var index = i + 1;
                if ($('#img_' + i).attr('src') != "") {
                    myList.push($('#img_' + i).attr('src'));

                    if ($('#Img_ID_' + i).val() != "" && $('#Img_ID_' + i).val() != null) {
                        ListID.push($('#Img_ID_' + i).val());
                        if (i == id) {
                            ListDelete.push($('#Img_ID_' + i).val());
                        }


                    }

                }
            }

            //hide last index
            var LastIndexDiv = myList.length - 1;
            //alert("LastIndexDiv : " + LastIndexDiv);
            $('#Div_' + LastIndexDiv).attr('hidden', 'hidden');


            $.ajax({
                type: "POST",
                url: "/ProjectUpdateStatus/RemovePhoto_From_Database",
                data: { ID: id, List: myList, ListID: ListID, ListDelete: ListDelete },
                dataType: "json",
                success: function (response) {
                    if (response.code === 1) {
                        window.location = '/Login/Logout';
                    }
                    else {
                        ClearSrcPhoto();


                        for (var i = 0; i < response[0].List.length; i++) {

                            $('#img_' + i).attr('src', response[0].List[i]);
                            $('#img_file_' + i).val(response[0].List[i]);
                        }

                        for (var i = 0; i < response[0].ListID.length; i++) {
                            $('#Img_ID_' + i).val(response[0].ListID[i]);
                            $('#img_file_' + i).val("");
                        }

                        //Delete image from DB
                        for (var i = 0; (i < 5 && response[0].ListDelete != null); i++) {
                            if ($('#img_delete_' + i).val() == null || $('#img_delete_' + i).val() == "") {
                                $('#img_delete_' + i).val(response[0].ListDelete[0]);
                                break;
                            }

                        }
                    }

                },
                failure: function (response) {
                },
                error: function (response) {
                }
            });


        }

        function ClearSrcPhoto() {
            $('#img_0').attr('src', '');
            $('#Img_ID_0').val("");
            $('#img_1').attr('src', '');
            $('#Img_ID_1').val("");
            $('#img_2').attr('src', '');
            $('#Img_ID_2').val("");
            $('#img_3').attr('src', '');
            $('#Img_ID_3').val("");
            $('#img_4').attr('src', '');
            $('#Img_ID_4').val("");

            $('#img_file_0').val("");
            $('#img_file_1').val("");
            $('#img_file_2').val("");
            $('#img_file_3').val("");
            $('#img_file_4').val("");
        }

		function Preview(input) // add
		{
			if (input.files && input.files[0]) {
				var reader = new FileReader();

				reader.onload = function (e) {
					if ($('#img_0').attr('src') == "") {
						$('#img_0').attr('src', e.target.result);
						$('#Div_0').removeAttr('hidden');


						$('#img_file_0').val(e.target.result);
					}
					else if ($('#img_1').attr('src') == "") {
						$('#img_1').attr('src', e.target.result);
						$('#Div_1').removeAttr('hidden');

						$('#img_file_1').val(e.target.result);
					}
					else if ($('#img_2').attr('src') == "") {
						$('#img_2').attr('src', e.target.result);
						$('#Div_2').removeAttr('hidden');

						$('#img_file_2').val(e.target.result);
					}
					else if ($('#img_3').attr('src') == "") {
						$('#img_3').attr('src', e.target.result);
						$('#Div_3').removeAttr('hidden');

						$('#img_file_3').val(e.target.result);
					}
					else if ($('#img_4').attr('src') == "") {
						$('#img_4').attr('src', e.target.result);
						$('#Div_4').removeAttr('hidden');

						$('#img_file_4').val(e.target.result);
					}
                    else {
                        alert("You can only upload a maximum of 5 images");
                    }

				}

				reader.readAsDataURL(input.files[0]); // convert to base64 string
			}
			$("#uploadfile").val("");
		}



		function CloseModal() {
			$('#ViewPicture').modal('hide');
		}
	</script>


